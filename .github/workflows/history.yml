name: Generate 1990 History

on:
  workflow_dispatch:  # запуск вручную

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Git
        run: |
          git config user.name "VadimUpdate"
          git config user.email "lyutovvadim@gmail.com"

      - name: Generate 1990 commits
        run: |
          YEAR=1990
          COMMITS=20
          echo "**$YEAR** - Generated by history script" > README.md
          git add README.md
          git commit -m "$YEAR initial commit" --date "$YEAR-01-01T18:00:00"
          
          for i in $(seq 1 $COMMITS); do
            echo "Commit #$i" >> README.md
            git add README.md
            MONTH=$(printf "%02d" $((RANDOM % 12 + 1)))
            DAY=$(printf "%02d" $((RANDOM % 28 + 1)))
            HOUR=$(printf "%02d" $((RANDOM % 24)))
            MIN=$(printf "%02d" $((RANDOM % 60)))
            DATE="${YEAR}-${MONTH}-${DAY}T${HOUR}:${MIN}:00"
            git commit -m "Commit #$i on $DATE" --date "$DATE"
          done

      - name: Push changes
        env:
          TOKEN: ${{ secrets.MY_GITHUB_TOKEN }}
        run: |
          git remote set-url origin https://VadimUpdate:${TOKEN}@github.com/VadimUpdate/1990-history.git
          git push origin main
